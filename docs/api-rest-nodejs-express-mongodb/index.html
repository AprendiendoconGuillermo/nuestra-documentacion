<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Node js Express con MongoDB | Aprendiendo con Guillermo 🤓</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/nuestra-documentacion/img/logo.png">
    <meta name="description" content="Documentacion de mis cursos">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/nuestra-documentacion/assets/css/0.styles.46b5e78f.css" as="style"><link rel="preload" href="/nuestra-documentacion/assets/js/app.30aeb75f.js" as="script"><link rel="preload" href="/nuestra-documentacion/assets/js/3.e1f8113b.js" as="script"><link rel="preload" href="/nuestra-documentacion/assets/js/12.c7a695f1.js" as="script"><link rel="preload" href="/nuestra-documentacion/assets/js/10.4c85e128.js" as="script"><link rel="prefetch" href="/nuestra-documentacion/assets/js/1.eea657cd.js"><link rel="prefetch" href="/nuestra-documentacion/assets/js/11.8db2d58d.js"><link rel="prefetch" href="/nuestra-documentacion/assets/js/13.39a6fac6.js"><link rel="prefetch" href="/nuestra-documentacion/assets/js/14.75e63f61.js"><link rel="prefetch" href="/nuestra-documentacion/assets/js/15.f7ded784.js"><link rel="prefetch" href="/nuestra-documentacion/assets/js/16.f6f01aa8.js"><link rel="prefetch" href="/nuestra-documentacion/assets/js/17.809f8703.js"><link rel="prefetch" href="/nuestra-documentacion/assets/js/18.35ba19e1.js"><link rel="prefetch" href="/nuestra-documentacion/assets/js/19.00033887.js"><link rel="prefetch" href="/nuestra-documentacion/assets/js/20.c7e833a7.js"><link rel="prefetch" href="/nuestra-documentacion/assets/js/21.a1ed314d.js"><link rel="prefetch" href="/nuestra-documentacion/assets/js/22.e40eb265.js"><link rel="prefetch" href="/nuestra-documentacion/assets/js/23.b38410c1.js"><link rel="prefetch" href="/nuestra-documentacion/assets/js/24.f8d81fc8.js"><link rel="prefetch" href="/nuestra-documentacion/assets/js/25.f30e834c.js"><link rel="prefetch" href="/nuestra-documentacion/assets/js/26.0e13aaab.js"><link rel="prefetch" href="/nuestra-documentacion/assets/js/27.c8e614c1.js"><link rel="prefetch" href="/nuestra-documentacion/assets/js/28.f3087ad3.js"><link rel="prefetch" href="/nuestra-documentacion/assets/js/29.a8a5d39e.js"><link rel="prefetch" href="/nuestra-documentacion/assets/js/30.0ce3cc81.js"><link rel="prefetch" href="/nuestra-documentacion/assets/js/31.428d484f.js"><link rel="prefetch" href="/nuestra-documentacion/assets/js/32.93d5f0c2.js"><link rel="prefetch" href="/nuestra-documentacion/assets/js/33.276305d3.js"><link rel="prefetch" href="/nuestra-documentacion/assets/js/34.bcc50319.js"><link rel="prefetch" href="/nuestra-documentacion/assets/js/35.3dcabb49.js"><link rel="prefetch" href="/nuestra-documentacion/assets/js/36.552f33a0.js"><link rel="prefetch" href="/nuestra-documentacion/assets/js/4.f685b017.js"><link rel="prefetch" href="/nuestra-documentacion/assets/js/5.bc21a9a5.js"><link rel="prefetch" href="/nuestra-documentacion/assets/js/6.43a6ae7d.js"><link rel="prefetch" href="/nuestra-documentacion/assets/js/7.72e1f417.js"><link rel="prefetch" href="/nuestra-documentacion/assets/js/8.ac62e461.js"><link rel="prefetch" href="/nuestra-documentacion/assets/js/9.0c9b8318.js">
    <link rel="stylesheet" href="/nuestra-documentacion/assets/css/0.styles.46b5e78f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/nuestra-documentacion/" class="home-link router-link-active"><!----> <span class="site-name">Aprendiendo con Guillermo 🤓</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/nuestra-documentacion/" class="nav-link">
  Inicio
</a></div><div class="nav-item"><a href="https://www.facebook.com/AprendiendoconGuillermo" target="_blank" rel="noopener noreferrer" class="nav-link external">
  facebook
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://www.youtube.com/AprendiendoconGuillermo?sub_confirmation=1" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Mi canal 📺
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="📢 Mis cursos" class="dropdown-title"><span class="title">📢 Mis cursos</span> <span class="arrow down"></span></button> <button type="button" aria-label="📢 Mis cursos" class="mobile-dropdown-title"><span class="title">📢 Mis cursos</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://www.youtube.com/watch?v=bNKCKVVx3So&amp;list=PLRoF0hqfyCW-lfoIQ3PD8NbRZyBfzKBXZ" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Java para principantes 🤓
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.youtube.com/watch?v=EsEVrjVxjX4&amp;list=PLRoF0hqfyCW-Pyg01UJ3woDojSRWgKiRK" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Subnetting 🔌
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.youtube.com/watch?v=hooMs4Qnn84&amp;list=PLRoF0hqfyCW9-VzxOWKO36qW5SQBE8dnJ" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Planificación de la CPU 💻
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/nuestra-documentacion/" class="nav-link">
  Inicio
</a></div><div class="nav-item"><a href="https://www.facebook.com/AprendiendoconGuillermo" target="_blank" rel="noopener noreferrer" class="nav-link external">
  facebook
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://www.youtube.com/AprendiendoconGuillermo?sub_confirmation=1" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Mi canal 📺
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="📢 Mis cursos" class="dropdown-title"><span class="title">📢 Mis cursos</span> <span class="arrow down"></span></button> <button type="button" aria-label="📢 Mis cursos" class="mobile-dropdown-title"><span class="title">📢 Mis cursos</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://www.youtube.com/watch?v=bNKCKVVx3So&amp;list=PLRoF0hqfyCW-lfoIQ3PD8NbRZyBfzKBXZ" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Java para principantes 🤓
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.youtube.com/watch?v=EsEVrjVxjX4&amp;list=PLRoF0hqfyCW-Pyg01UJ3woDojSRWgKiRK" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Subnetting 🔌
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.youtube.com/watch?v=hooMs4Qnn84&amp;list=PLRoF0hqfyCW9-VzxOWKO36qW5SQBE8dnJ" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Planificación de la CPU 💻
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Hola 🤓</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java para principiantes desde cero en NetBeans</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java-Progrmación Orientada a Objetos (POO)</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Api Rest</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/nuestra-documentacion/api-rest-nodejs-express-mongodb/" aria-current="page" class="active sidebar-link">Node js Express con MongoDB</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/nuestra-documentacion/api-rest-nodejs-express-mongodb/#_1-creacion-del-proyecto" class="sidebar-link">1. Creación del proyecto</a></li><li class="sidebar-sub-header"><a href="/nuestra-documentacion/api-rest-nodejs-express-mongodb/#_2-instalacion-de-dependencias" class="sidebar-link">2. Instalación de dependencias</a></li><li class="sidebar-sub-header"><a href="/nuestra-documentacion/api-rest-nodejs-express-mongodb/#_3-ejecucion-del-proyecto" class="sidebar-link">3. Ejecución del proyecto</a></li><li class="sidebar-sub-header"><a href="/nuestra-documentacion/api-rest-nodejs-express-mongodb/#_4-estructura-del-proyecto" class="sidebar-link">4. Estructura del proyecto</a></li><li class="sidebar-sub-header"><a href="/nuestra-documentacion/api-rest-nodejs-express-mongodb/#_5-encripta-la-contrasena-de-tu-usuario" class="sidebar-link">5. Encripta la contraseña de tu usuario</a></li><li class="sidebar-sub-header"><a href="/nuestra-documentacion/api-rest-nodejs-express-mongodb/#_7-desencripta-la-contrasena-de-tu-usuario" class="sidebar-link">7. Desencripta la contraseña de tu usuario</a></li><li class="sidebar-sub-header"><a href="/nuestra-documentacion/api-rest-nodejs-express-mongodb/#_6-dale-seguridad-a-tu-api-con-jwt" class="sidebar-link">6. Dale seguridad a tu Api con JWT</a></li></ul></li><li><a href="/nuestra-documentacion/api-rest-nodejs-express-mongodb/spring-boot-mysql.html" class="sidebar-link">Spring Boot con MySql</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Consumir Api en VuePress</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Pruebas</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="node-js-express-con-mongodb"><a href="#node-js-express-con-mongodb" class="header-anchor">#</a> Node js Express con MongoDB</h1> <div class="container" style="text-align:center;"><span style="font-size:25px">  0 </span> <button class="btn btn-primary">Like 👍</button></div> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <ul><li>Debe tener instalado <a href="https://nodejs.org/en/" target="_blank" rel="noopener noreferrer">Node.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>Debe tener instalado <a href="https://www.mongodb.com/try/download/community" target="_blank" rel="noopener noreferrer">MongoDB<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> y tener ya un usuario y base creada <a href="https://docs.mongodb.com/manual/tutorial/getting-started/" target="_blank" rel="noopener noreferrer">click para la documentación<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <h2 id="_1-creacion-del-proyecto"><a href="#_1-creacion-del-proyecto" class="header-anchor">#</a> 1. Creación del proyecto</h2> <ul><li>Cree una carpeta donde guste, esta contendrá el proyecto, por ejemplo:</li></ul> <div style="text-align:center;"><img src="/nuestra-documentacion/img/api-nodejs/1.png" alt="Creació de la carpeta"></div> <ul><li>Dentro de la carpeta abriremos el cmd, y nos debe salir la siguiente ruta, debemos darnos cuenta que esté el nombre de la carpeta creada en el punto anterior</li></ul> <div style="text-align:center;"><img src="/nuestra-documentacion/img/api-nodejs/2.png" alt="Creació de la carpeta"></div> <ul><li>Escribiremos el siguiente comando <code>mkdir</code> seguido del nombre de la carpeta que tendrá el proyecto, por ejemplo:</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">mkdir</span> proyecto
</code></pre></div><div style="text-align:center;"><img src="/nuestra-documentacion/img/api-nodejs/3.png" alt="Creació de la carpeta"></div> <ul><li>Luego entraremos a la carpeta con <code>cd</code> seguido del nombre que se le dió en el punto anterior</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token builtin class-name">cd</span> proyecto
</code></pre></div><div style="text-align:center;"><img src="/nuestra-documentacion/img/api-nodejs/4.png" alt="Creació de la carpeta"></div> <ul><li>Estando dentro de nuestro proyecto, toca crear el archivo <code>package.json</code>, pero no te preocupes, esto se lo crea con el siguiente comando:</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> init
</code></pre></div><div style="text-align:center;"><img src="/nuestra-documentacion/img/api-nodejs/5.png" alt="Creació de la carpeta"></div> <ul><li>Luego nos solicitará algunos datos para configurar el proyecto, puedes darle enter omitiendo o puedes ingresar, como sea tu elección.</li></ul> <div style="text-align:center;"><img src="/nuestra-documentacion/img/api-nodejs/6.png" alt="Creació de la carpeta"></div> <p>Con esto ya tenemos creado el proyecto, para abrirlo basta escribir <code>code .</code> para que se nos abra <strong>Visual Studio Code</strong></p> <div style="text-align:center;"><img src="/nuestra-documentacion/img/api-nodejs/7.png" alt="Creació de la carpeta"></div> <p>Veremos únicamente el archivo <code>json</code> creado en puntos anteriores</p> <div style="text-align:center;"><img src="/nuestra-documentacion/img/api-nodejs/8.png" alt="Creació de la carpeta"></div> <h2 id="_2-instalacion-de-dependencias"><a href="#_2-instalacion-de-dependencias" class="header-anchor">#</a> 2. Instalación de dependencias</h2> <ul><li><strong>La primera dependencia</strong> que instalaremos será <code>express</code>, y para ello podemos dijitar el siguiente comando en el cmd si aún no la has cerrado o abriendo el terminal en el <strong>Visual Studio Code</strong></li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span> express --save
</code></pre></div><p><code>cmd</code></p><div style="text-align:center;"><img src="/nuestra-documentacion/img/api-nodejs/9.png" alt="Creació de la carpeta"></div><p></p> <p><code>Visual Studio Code</code></p><div style="text-align:center;"><img src="/nuestra-documentacion/img/api-nodejs/10.png" alt="Creació de la carpeta"></div><p></p> <p><code>instalación</code></p><div style="text-align:center;"><img src="/nuestra-documentacion/img/api-nodejs/11.png" alt="Creació de la carpeta"></div><p></p> <ul><li>Luego de la instalación veremos que nos aparece otro archivo <code>json</code> este tendrá las dependencias y la carpeta <code>node_modules</code> tendrá las carpetas de dichas dependencias</li></ul> <div style="text-align:center;"><img src="/nuestra-documentacion/img/api-nodejs/12.png" alt="Creació de la carpeta"></div> <ul><li><p><strong>La segunda dependencia</strong> será la que nos permitirá conectarnos a la <code>mongoDb</code>, podemos instalar</p> <ul><li><a href="https://www.npmjs.com/package/mongoose" target="_blank" rel="noopener noreferrer">mongoose<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><div class="language-sh extra-class"><pre class="language-sh"><code>   <span class="token function">npm</span> <span class="token function">install</span> mongoose
</code></pre></div></li> <li><a href="https://www.npmjs.com/package/mongodb" target="_blank" rel="noopener noreferrer">mongodb<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><div class="language-sh extra-class"><pre class="language-sh"><code>    <span class="token function">npm</span> <span class="token function">install</span> mongodb
</code></pre></div></li></ul> <p>Elegiré la primera opción</p></li></ul> <div style="text-align:center;"><img src="/nuestra-documentacion/img/api-nodejs/13.png" alt="Creació de la carpeta"></div> <p>Y puedes observar en <code>package.json</code> la nueva dependencia</p> <ul><li><strong>La tercera dependencia</strong> será <a href="https://www.npmjs.com/package/nodemon" target="_blank" rel="noopener noreferrer"><code>nodemon</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> esta nos permitirá un ambiente de trabajo más fluido.</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span> nodemon
</code></pre></div><div style="text-align:center;"><img src="/nuestra-documentacion/img/api-nodejs/14.png" alt="Creació de la carpeta"></div> <p>Luego, debemos hacer un pequeño cambio al <code>package.json</code> agregando al <code>scripts</code> lo siguiente:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nodemon app.js&quot;</span>
</code></pre></div><p>Y ese será el archivo que se reiniciará con cada cambio.</p> <div style="text-align:center;"><img src="/nuestra-documentacion/img/api-nodejs/15.png" alt="Creació de la carpeta"></div> <ul><li><strong>La cuarta dependencia</strong> será <a href="https://www.npmjs.com/package/body-parser" target="_blank" rel="noopener noreferrer"><code>body-parser</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> será para el middleware</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span> body-parser
</code></pre></div><div style="text-align:center;"><img src="/nuestra-documentacion/img/api-nodejs/16.png" alt="Creació de la carpeta"></div> <h2 id="_3-ejecucion-del-proyecto"><a href="#_3-ejecucion-del-proyecto" class="header-anchor">#</a> 3. Ejecución del proyecto</h2> <ul><li>Primero crearemos un archivo <code>app.js</code> debe tener nombre dado cuando se instaló <code>nodemon</code>.</li> <li>Luego dentro del archivo escribieremos lo siguiente</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// importamos express</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// llamanos al función</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// escuchamos el puerto 3000 y mostramos un mensaje por consola</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Conectado'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Y para ejecutar, en el terminal escribiremos</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> start
</code></pre></div><p>Y, listo 🤓 hemos ejecutado nuestro proyecto pero aún falta para hacerlo <code>api-rest</code> 🥴</p> <div style="text-align:center;"><img src="/nuestra-documentacion/img/api-nodejs/17.png" alt="Creació de la carpeta"></div> <h2 id="_4-estructura-del-proyecto"><a href="#_4-estructura-del-proyecto" class="header-anchor">#</a> 4. Estructura del proyecto</h2> <p>La estructura será la siguiente</p> <ul><li><p><strong>PROYECTO</strong></p> <ul><li><strong>node_modules</strong></li> <li><strong>src</strong> <ul><li>app</li> <li>config</li> <li>controller</li> <li>repository</li> <li>service</li> <li>exception</li> <li>collection</li> <li>route</li></ul></li> <li><strong>app.js</strong></li> <li><strong>package-lock.json</strong></li> <li><strong>package.json</strong></li></ul></li> <li><p><strong>Dentro de la carpeta <code>config</code></strong> crearemos un archivo <code>server.js</code> que contrendrá las credenciales del servidor y el puerto que escuchará nuestra aplicación.</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * BD: mongodb 
 * user: aprendiendo
 * pass: 123456
 * server: localhost
 * port: 27017
 * bd: pruebas
 */</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    port <span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">||</span> <span class="token number">3000</span><span class="token punctuation">,</span> <span class="token comment">//puerto que escuchará nuestra aplicación</span>
    mongodb <span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">MONGODB</span> <span class="token operator">||</span> <span class="token string">'mongodb://aprendiendo:123456@localhost:27017/proyecto'</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><strong>Dentro de la carpeta <code>exception</code></strong> creamos un archivo <code>exception.js</code> que contrendrá nuestras excepciones personalizadas, y estas son algunas, podemos tener más dependiendo la necesidad del proyecto.</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// excepción al crear una colección</span>
<span class="token keyword">const</span> <span class="token function-variable function">create</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span> payload</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">message</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token number">201</span><span class="token punctuation">,</span> payload<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
<span class="token punctuation">}</span>
<span class="token comment">// excepción al enviar una petición errónea</span>
<span class="token keyword">const</span> <span class="token function-variable function">badRequest</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span> payload</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">message</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">,</span> payload<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// excepción interna del proyecto </span>
<span class="token keyword">const</span> <span class="token function-variable function">internalError</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span> payload</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">message</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span> payload<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// mensaje a devolver</span>
<span class="token keyword">function</span> <span class="token function">message</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span> code<span class="token punctuation">,</span> payload<span class="token punctuation">,</span> flag</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;error&quot;</span><span class="token operator">:</span> flag<span class="token punctuation">,</span> <span class="token string">&quot;payload&quot;</span><span class="token operator">:</span> payload<span class="token operator">??</span><span class="token keyword">null</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// exportamos las excepciones para poder importarlas en otros archivos</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    create<span class="token punctuation">,</span>
    badRequest<span class="token punctuation">,</span>
    internalError
<span class="token punctuation">}</span>
</code></pre></div><ul><li><strong>Dentro de la carpeta <code>collection</code></strong> crearemos nuestros modelos o esquemas de nuestra base, por esta práctica crearemos un sólo esquema persona y el archivo será <code>personCollection.js</code>.</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// importamos mongoose para poder hacer uso del schema</span>
<span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// creamos nuestro esquema</span>
<span class="token keyword">const</span> Person <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> String<span class="token punctuation">,</span>
    city<span class="token operator">:</span> String
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// creamos una constante de nuestro modelo para poderlo exportar</span>
<span class="token keyword">const</span> Person <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'Person'</span><span class="token punctuation">,</span> collectionPerson<span class="token punctuation">,</span> <span class="token string">'Person'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// exportamos nuestro esquema</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Person<span class="token punctuation">;</span>
</code></pre></div><ul><li><strong>Dentro de la carpeta <code>repository</code></strong> crearemos el archivo <code>personRepository.js</code> y aquí haremos todo las setencias a nuestra base, es decir, es aquí donde guardaremos, buscaremos, actualizaremos y eliminaremos nuestros documentos.</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// importamos nuestro esquema</span>
<span class="token keyword">const</span> Person <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../collection/personCollection.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// el método es async porque devuelve una promesa</span>
<span class="token keyword">const</span> <span class="token function-variable function">guardar</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> p <span class="token operator">=</span>  <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token keyword">return</span> <span class="token keyword">await</span> p<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">buscar</span> <span class="token operator">=</span> <span class="token keyword">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> Person<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">actualizar</span> <span class="token operator">=</span> <span class="token keyword">async</span><span class="token punctuation">(</span><span class="token parameter">req</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> Person<span class="token punctuation">.</span><span class="token function">findByIdAndUpdate</span><span class="token punctuation">(</span>
        <span class="token punctuation">{</span>
            _id<span class="token operator">:</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            $set<span class="token operator">:</span>
            <span class="token punctuation">{</span>
                name <span class="token operator">:</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
                city <span class="token operator">:</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>city
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">eliminar</span> <span class="token operator">=</span> <span class="token keyword">async</span><span class="token punctuation">(</span><span class="token parameter">req</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> Person<span class="token punctuation">.</span><span class="token function">findByIdAndDelete</span><span class="token punctuation">(</span>
        <span class="token punctuation">{</span>
            _id<span class="token operator">:</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// exporamos nuestro método para poder importarlo en nuestro servicio</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    guardar<span class="token punctuation">,</span>
    buscar<span class="token punctuation">,</span>
    actualizar<span class="token punctuation">,</span>
    eliminar
<span class="token punctuation">}</span>
</code></pre></div><ul><li><strong>Dentro de la carpeta <code>service</code></strong> crearemos un archivo <code>personService.js</code> es la parte media entre el controllador y repositorio, y es aquí donde se valida los datos, lanza excepciones y demás.</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// importamos nuestro repositorio</span>
<span class="token keyword">const</span> repository <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../repository/personRepository.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// importamos nuestras excepciones</span>
<span class="token keyword">const</span> exception <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../exception/exception.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// esta función recibe el requerimiento (body) y respuesta (http)</span>
<span class="token keyword">function</span> <span class="token function">guardar</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  
    <span class="token keyword">try</span> <span class="token punctuation">{</span>                
        <span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">&quot;&quot;</span> <span class="token operator">||</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>city <span class="token operator">==</span> <span class="token string">&quot;&quot;</span> <span class="token operator">||</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>city <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token comment">// exception si los datos no son los esperados</span>
           exception<span class="token punctuation">.</span><span class="token function">badRequest</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">&quot;Ingrese los datos&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            
        <span class="token keyword">else</span><span class="token punctuation">{</span>
            repository<span class="token punctuation">.</span><span class="token function">guardar</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">doc</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">// exception de creación</span>
                exception<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">&quot;Datos ingresados&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">// exception si hubo algo inesperado con la solicitud</span>
                exception<span class="token punctuation">.</span><span class="token function">badRequest</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>            
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// exception interna del programa</span>
        exception<span class="token punctuation">.</span><span class="token function">internalError</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">&quot;Problema inesperado&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// esta función recibe el requerimiento (body) y respuesta (http)</span>
<span class="token keyword">function</span> <span class="token function">buscar</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>       
    <span class="token keyword">try</span> <span class="token punctuation">{</span>                       
        repository<span class="token punctuation">.</span><span class="token function">buscar</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">doc</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// exception de creación            </span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
                exception<span class="token punctuation">.</span><span class="token function">found</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> doc<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span>
                exception<span class="token punctuation">.</span><span class="token function">notFound</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">&quot;No hay documentos que mostrar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// exception si hubo algo inesperado con la solicitud</span>
            exception<span class="token punctuation">.</span><span class="token function">badRequest</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                 
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// exception interna del programa</span>
        exception<span class="token punctuation">.</span><span class="token function">internalError</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">&quot;Problema inesperado&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// esta función recibe el requerimiento (body) y respuesta (http)</span>
<span class="token keyword">function</span> <span class="token function">actualizar</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>       
    <span class="token keyword">try</span> <span class="token punctuation">{</span>   
        <span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">&quot;&quot;</span> <span class="token operator">||</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>city <span class="token operator">==</span> <span class="token string">&quot;&quot;</span> <span class="token operator">||</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>city <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token comment">// exception si los datos no son los esperados</span>
           exception<span class="token punctuation">.</span><span class="token function">badRequest</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">&quot;Ingrese los datos&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            
        <span class="token keyword">else</span><span class="token punctuation">{</span>                                
            repository<span class="token punctuation">.</span><span class="token function">actualizar</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">doc</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">// exception de actualización  </span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>doc <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                    exception<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">&quot;Documento actualizado&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">else</span>
                    exception<span class="token punctuation">.</span><span class="token function">notFound</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">&quot;No existe el documento&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">// exception si hubo algo inesperado con la solicitud</span>
                exception<span class="token punctuation">.</span><span class="token function">badRequest</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">&quot;El id tiene un formato erróneo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span>                
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// exception interna del programa</span>
        exception<span class="token punctuation">.</span><span class="token function">internalError</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">&quot;Problema inesperado&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// esta función recibe el requerimiento (body) y respuesta (http)</span>
<span class="token keyword">function</span> <span class="token function">eliminar</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>       
    <span class="token keyword">try</span> <span class="token punctuation">{</span>   
        <span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id <span class="token operator">==</span> <span class="token string">&quot;&quot;</span> <span class="token operator">||</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token punctuation">)</span>
            <span class="token comment">// exception si los datos no son los esperados</span>
           exception<span class="token punctuation">.</span><span class="token function">badRequest</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">&quot;Ingrese los datos&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            
        <span class="token keyword">else</span><span class="token punctuation">{</span>                                
            repository<span class="token punctuation">.</span><span class="token function">eliminar</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">doc</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">// exception de creación      </span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>doc <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                    exception<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">&quot;Documento eliminado&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">else</span>
                    exception<span class="token punctuation">.</span><span class="token function">notFound</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">&quot;No existe el documento&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">// exception si hubo algo inesperado con la solicitud</span>
                exception<span class="token punctuation">.</span><span class="token function">badRequest</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">&quot;El id tiene un formato erróneo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span>                
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// exception interna del programa</span>
        exception<span class="token punctuation">.</span><span class="token function">internalError</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">&quot;Problema inesperado&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment">// exportamos el método para poderlo importar en el controllador</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    guardar<span class="token punctuation">,</span>
    buscar<span class="token punctuation">,</span>
    actualizar<span class="token punctuation">,</span>
    eliminar
<span class="token punctuation">}</span>
</code></pre></div><ul><li><strong>Dentro de la carpeta <code>controller</code></strong> crearemos un archivo <code>personController.js</code>, aquí llamaremos a todos los métodos de nuestro servicio persona.</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// importamos nuestro servicio</span>
<span class="token keyword">const</span> service <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../service/personService.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// importamos nuestras excepciones</span>
<span class="token keyword">const</span> exception <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../exception/exception.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// método insertar</span>
<span class="token keyword">function</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    
    <span class="token keyword">try</span> <span class="token punctuation">{</span>     
        <span class="token comment">// llamamos a nuestro método</span>
        service<span class="token punctuation">.</span><span class="token function">guardar</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>        
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// exception inesperada</span>
        exception<span class="token punctuation">.</span><span class="token function">internalError</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">&quot;Problema inesperado&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>     
        <span class="token comment">// llamamos a nuestro método</span>
        service<span class="token punctuation">.</span><span class="token function">buscar</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>        
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// exception inesperada</span>
        exception<span class="token punctuation">.</span><span class="token function">internalError</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">&quot;Problema inesperado&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>     
        <span class="token comment">// llamamos a nuestro método</span>
        service<span class="token punctuation">.</span><span class="token function">actualizar</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>        
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// exception inesperada</span>
        exception<span class="token punctuation">.</span><span class="token function">internalError</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">&quot;Problema inesperado&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">borrar</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>     
        <span class="token comment">// llamamos a nuestro método</span>
        service<span class="token punctuation">.</span><span class="token function">eliminar</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>        
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// exception inesperada</span>
        exception<span class="token punctuation">.</span><span class="token function">internalError</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">&quot;Problema inesperado&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    insert<span class="token punctuation">,</span>
    select<span class="token punctuation">,</span>
    update<span class="token punctuation">,</span>
    borrar
<span class="token punctuation">}</span>
</code></pre></div><ul><li><strong>Dentro de la carpeta <code>route</code></strong> crearemos un archivo <code>personRoute.js</code> que contrendrá las rutas de nuestros endpoints de persona.</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// importamos express</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// hacemos uso de la función Router()</span>
<span class="token keyword">const</span> api <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// importamos nuestro controlador</span>
<span class="token keyword">const</span> personCroller <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../controller/personController.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// hacemos uso de los métodos http</span>
api<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/add'</span><span class="token punctuation">,</span>personCroller<span class="token punctuation">.</span>insert<span class="token punctuation">)</span><span class="token punctuation">;</span>
api<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/select'</span><span class="token punctuation">,</span> personCroller<span class="token punctuation">.</span>select<span class="token punctuation">)</span><span class="token punctuation">;</span>
api<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">'/update/:id/'</span> <span class="token punctuation">,</span> personCroller<span class="token punctuation">.</span>update<span class="token punctuation">)</span><span class="token punctuation">;</span>
api<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">'/delete/:id'</span><span class="token punctuation">,</span>personCroller<span class="token punctuation">.</span>borrar<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// exportamos api</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> api<span class="token punctuation">;</span>
</code></pre></div><ul><li><strong>Dentro de la carpeta <code>app</code></strong> crearemos un archivo <code>app.js</code> que contrendrá o hará de almacenar todos los accesos a las rutas de nuestra <code>api-rest</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// importamos express</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// importamos body-parser</span>
<span class="token keyword">const</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'body-parser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// llamanos al función</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// importamos nuestro archivo que contiene las rutas o endpoints de persona</span>
<span class="token keyword">const</span> api <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../route/personRoute.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// hacemos uso de body-parser</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span>extended<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// hacemos uso de nuestra ruta de persona</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/api'</span><span class="token punctuation">,</span> api<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* si tuvieramos más rutas de otras collections haríamos todo como se hiso con persona
 * y aquí haríamos udo de la ruta por ejemplo
 * app.use('/api', api2);
 */</span>
<span class="token comment">// exportamos app para llamarlo en nuestro archivo app.js que está en la raíz de nuestro proyecto</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> app<span class="token punctuation">;</span>
</code></pre></div><p>Teniendo lista la estructura con sus archivos correspondientes, ahora toca modificar el archivo <code>app.js</code> que está en la raíz del proyecto para acceder a la base y modificar el escuchar nuestra aplicación.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// importamos mongoose para la base</span>
<span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// importamos app</span>
<span class="token keyword">const</span> personApp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./src/app/app.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// importamos la configuración del servidor</span>
<span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./src/config/server.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// nos conectamos al la base</span>
mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>server<span class="token punctuation">.</span>mongodb<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//creamos una constante de la connection</span>
<span class="token keyword">const</span> connection <span class="token operator">=</span> mongoose<span class="token punctuation">.</span>connection<span class="token punctuation">;</span>
<span class="token comment">// mostramos un console si ha fue exitosa</span>
connection<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'MongoDb success'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// mostramos un console si ha fue errónea</span>
connection<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Echale agua para que encienda'</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// escuchamos el puerto</span>
personApp<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>server<span class="token punctuation">.</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Conectado'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Proyecto terminado</p> <div style="text-align:center;"><img src="/nuestra-documentacion/img/api-nodejs/18.png" alt="Creació de la carpeta"></div> <p><a href="/nuestra-documentacion/pruebas/test-api-nodejs">Dame click para ver la ejecución</a><br> <a href="http://fumacrom.com/2tqLt" target="_blank" rel="noopener noreferrer">Dame click para descargar el proyecto<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="_5-encripta-la-contrasena-de-tu-usuario"><a href="#_5-encripta-la-contrasena-de-tu-usuario" class="header-anchor">#</a> 5. Encripta la contraseña de tu usuario</h2> <p>Para esta práctica vale tener un <code>schema</code> que haga referencia a <code>usuarios</code>, sin embargo por motivo de práctica, aumentaremos un campo <code>pass</code> al schema <code>person</code> y quedaría de la siguiente forma:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// importamos mongoose para poder hacer uso del schema</span>
<span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// creamos nuestro esquema</span>
<span class="token keyword">const</span> collectionPerson <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> String<span class="token punctuation">,</span>
    city<span class="token operator">:</span> String<span class="token punctuation">,</span>
    pass<span class="token operator">:</span> String
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// creamos una constante de nuestro modelo para poderlo exportar</span>
<span class="token keyword">const</span> Person <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'Person'</span><span class="token punctuation">,</span> collectionPerson<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// exportamos nuestro esquema</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Person<span class="token punctuation">;</span>
</code></pre></div><p>De igual manera debemos validar que al ingresar una documento, este campo esté lleno y el cambio quedaría de la siguiente forma:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">guardar</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  
    <span class="token keyword">try</span> <span class="token punctuation">{</span>                
        <span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">&quot;&quot;</span> <span class="token operator">||</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> 
           req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>city <span class="token operator">==</span> <span class="token string">&quot;&quot;</span> <span class="token operator">||</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>city <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> 
           req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>pass <span class="token operator">==</span> <span class="token string">&quot;&quot;</span> <span class="token operator">||</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>pass <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token comment">// exception si los datos no son los esperados</span>
           exception<span class="token punctuation">.</span><span class="token function">badRequest</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">&quot;Ingrese los datos&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            
        <span class="token keyword">else</span><span class="token punctuation">{</span>
            repository<span class="token punctuation">.</span><span class="token function">guardar</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">doc</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">// exception de creación</span>
                exception<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">&quot;Datos ingresados&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">// exception si hubo algo inesperado con la solicitud</span>
                exception<span class="token punctuation">.</span><span class="token function">badRequest</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>            
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// exception interna del programa</span>
        exception<span class="token punctuation">.</span><span class="token function">internalError</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">&quot;Problema inesperado&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Teniendo listo los cambios, ahora debemos elegir una dependencia que cumpla con la encriptación, hay varias, sos libre de elegir la que mejor te parezca, y bueno yo he instalado la siguiente <a href="https://cryptojs.gitbook.io/docs/" target="_blank" rel="noopener noreferrer"><code>cripto-js</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span> crypto-js
</code></pre></div><p>Ahora solo queda encriptar la contraseña, ¿Pero cómo 🤔?. Presta atención</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// importamos </span>
<span class="token keyword">const</span> CryptoJS <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;crypto-js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// nuestra contraseña</span>
<span class="token keyword">const</span> pass <span class="token operator">=</span> <span class="token string">&quot;123456&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// nuestra palabra clave de encriptación</span>
<span class="token keyword">const</span> secretKey <span class="token operator">=</span> <span class="token string">&quot;Aprendiendo&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// encriptar</span>
<span class="token keyword">const</span> passCrypto <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span><span class="token constant">AES</span><span class="token punctuation">.</span><span class="token function">encrypt</span><span class="token punctuation">(</span>pass<span class="token punctuation">,</span> secretKey<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// mostrar</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>passCrypto<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//salida =&gt; U2FsdGVkX18jpRlY5yNjiuyBSdbjPo3EjzaGBsdiEa4=</span>
</code></pre></div><p>Viste?, súper fácil, ahora solo basta acomodar eso en el servicio y listo.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Configura tu secretKey en config</p></div> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// importamos nuestro repositorio</span>
<span class="token keyword">const</span> repository <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../repository/personRepository.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// importamos nuestras excepciones</span>
<span class="token keyword">const</span> exception <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../exception/exception.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// importamos config</span>
<span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../config/server.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// importamos</span>
<span class="token keyword">const</span> CryptoJS <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;crypto-js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// esta función recibe el requerimiento (body) y respuesta (http)</span>
<span class="token keyword">function</span> <span class="token function">guardar</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  
    <span class="token keyword">try</span> <span class="token punctuation">{</span>                
        <span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">&quot;&quot;</span> <span class="token operator">||</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> 
           req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>city <span class="token operator">==</span> <span class="token string">&quot;&quot;</span> <span class="token operator">||</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>city <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> 
           req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>pass <span class="token operator">==</span> <span class="token string">&quot;&quot;</span> <span class="token operator">||</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>pass <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token comment">// exception si los datos no son los esperados</span>
           exception<span class="token punctuation">.</span><span class="token function">badRequest</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">&quot;Ingrese los datos&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            
        <span class="token keyword">else</span><span class="token punctuation">{</span>
            req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>pass <span class="token operator">=</span>  CryptoJS<span class="token punctuation">.</span><span class="token constant">AES</span><span class="token punctuation">.</span><span class="token function">encrypt</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>pass<span class="token punctuation">,</span> server<span class="token punctuation">.</span>secretKey<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            repository<span class="token punctuation">.</span><span class="token function">guardar</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">doc</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">// exception de creación</span>
                onst token <span class="token operator">=</span> <span class="token punctuation">{</span>
                    <span class="token string">&quot;token&quot;</span><span class="token operator">:</span> t<span class="token punctuation">.</span><span class="token function">createToken</span><span class="token punctuation">(</span>doc<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
                <span class="token comment">// enviamos el token</span>
                exception<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">&quot;Datos ingresados&quot;</span><span class="token punctuation">,</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">// exception si hubo algo inesperado con la solicitud</span>
                exception<span class="token punctuation">.</span><span class="token function">badRequest</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>            
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// exception interna del programa</span>
        exception<span class="token punctuation">.</span><span class="token function">internalError</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">&quot;Problema inesperado&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a href="/nuestra-documentacion/pruebas/test-api-nodejs">Dame click para ver la encriptación</a></p> <h2 id="_7-desencripta-la-contrasena-de-tu-usuario"><a href="#_7-desencripta-la-contrasena-de-tu-usuario" class="header-anchor">#</a> 7. Desencripta la contraseña de tu usuario</h2> <p>Esto super sencillo, basta con una línea, te daré la línea pero es tu deber saber donde lo colocas, te mostraré la ejecución con un <code>console.log();</code> descriptando la contraseña del paso 6 que es <code>Ecuado2021</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// consultamos de nuestra base la contraseña encriptada</span>
<span class="token keyword">const</span> passCryto <span class="token operator">=</span> <span class="token string">&quot;U2FsdGVkX1/rxCuneD4XFDTkILTnTa0xx0HfJUPtURQ=&quot;</span><span class="token punctuation">;</span> <span class="token comment">//la puedes ver en la clave en Pruebas</span>
<span class="token comment">// nuestra palabra clase de desencriptación</span>
<span class="token keyword">const</span> secretKey <span class="token operator">=</span> <span class="token string">&quot;Aprendiendo-con-Guillermo&quot;</span><span class="token punctuation">;</span> <span class="token comment">// esta clave está en mi config, recuerda hacer ese cambio</span>
<span class="token comment">// desencriptar</span>
<span class="token keyword">const</span> passOriginal <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span><span class="token constant">AES</span><span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>passCryto<span class="token punctuation">,</span> secretKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// mostrar</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>passOriginal<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Utf8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//salida =&gt; Ecuador2021</span>
</code></pre></div><h2 id="_6-dale-seguridad-a-tu-api-con-jwt"><a href="#_6-dale-seguridad-a-tu-api-con-jwt" class="header-anchor">#</a> 6. Dale seguridad a tu Api con JWT</h2> <p>Para darle seguridad a nuestra api usaremos <a href="https://jwt.io/" target="_blank" rel="noopener noreferrer"><code>jwt</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> y se compone de tres partes:</p> <ol><li>Header o cabecera</li> <li>Payload o carga útil</li> <li>Signature</li></ol> <p><strong>Primero</strong> que tenemos que hacer es instalar la dependencia <a href="https://openbase.com/js/jwt-simple" target="_blank" rel="noopener noreferrer"><code>jwt-simple</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, y <a href="https://www.npmjs.com/package/dayjs" target="_blank" rel="noopener noreferrer"><code>dayjs</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> de igual manera, puedes usar la que mejor te parezca</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span> jwt-simple
<span class="token function">npm</span> <span class="token function">install</span> dayjs
</code></pre></div><p><a href="https://day.js.org/docs/en/display/format" target="_blank" rel="noopener noreferrer"><code>Ver documentación de dayjs</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>Segundo</strong> es determinar la clave que se usará para cifrar tu token, recuerda que mientras más extensa, más segura será.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * BD: mongodb 
 * user: aprendiendo
 * pass: 123456
 * server: localhost
 * port: 27017
 * bd: pruebas
 */</span>
 module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    port <span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">||</span> <span class="token number">3000</span><span class="token punctuation">,</span> <span class="token comment">//puerto que escuchará nuestra aplicación</span>
    mongodb <span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">MONGODB</span> <span class="token operator">||</span> <span class="token string">'mongodb://aprendiendo:123456@localhost:27017/proyecto'</span><span class="token punctuation">,</span>
    secretKey <span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">SECRET_KEY</span> <span class="token operator">||</span> <span class="token string">'Aprendiendo-con-Guillermo'</span><span class="token punctuation">,</span>
    secretToken <span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">SECRET_TOKEN</span> <span class="token operator">||</span> <span class="token string">'@pr3nd13nd0c0nGu1ll3rm@'</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>Tercero</strong> será  reestructurar nuestro proyecto de la siguiente forma:</p> <div style="text-align:center;"><img src="/nuestra-documentacion/img/api-nodejs/30.png" alt="Creació de la carpeta"></div> <p><strong>Cuarto</strong> será crear y descodificar nuestro token, para esto nos iremos a <code>tokenService.js</code> y escribiremos los siguiente:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// importaciones</span>
<span class="token keyword">const</span> jwt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'jwt-simple'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> Day <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'dayjs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../../config/server.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// creación del token</span>
<span class="token keyword">const</span> <span class="token function-variable function">createToken</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">doc</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  
    <span class="token comment">// creamos el payload de nuestro token</span>
    <span class="token keyword">const</span> payload <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token comment">// información del token</span>
        sub<span class="token operator">:</span> doc<span class="token punctuation">.</span>_id<span class="token punctuation">,</span> <span class="token comment">// no se recomienda colocar el id, pero es un ejemplo</span>
        <span class="token comment">// creacion token</span>
        iat<span class="token operator">:</span> <span class="token function">Day</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// expirar token</span>
        p<span class="token operator">:</span> <span class="token function">Day</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'m'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unix</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// m -&gt; minuto &lt;- por ejemplo</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/** Podemos usar
     *  HS256
     *  HS384
     *  HS512
     */</span>
    <span class="token keyword">return</span> jwt<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> server<span class="token punctuation">.</span>secretToken<span class="token punctuation">,</span> <span class="token string">'HS256'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// decodificación del token</span>
<span class="token keyword">const</span> <span class="token function-variable function">decodeToken</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">token</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// creamos una promesa</span>
    <span class="token keyword">const</span> decode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span> err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span><span class="token punctuation">{</span>            
            <span class="token comment">// decoficamos el token</span>
            <span class="token keyword">const</span> payload <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> server<span class="token punctuation">.</span>secretToken<span class="token punctuation">,</span> <span class="token string">'HS256'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// verificamos si no ha expirado</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>payload<span class="token punctuation">.</span>exp <span class="token operator">&lt;=</span> <span class="token function">Day</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token function">err</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    message<span class="token operator">:</span> <span class="token string">'Su sesión ha expirado'</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token comment">// devolvemos algo de ser necesario, para indicar que todo está correcto</span>
            <span class="token function">res</span><span class="token punctuation">(</span>payload<span class="token punctuation">.</span>_id<span class="token punctuation">)</span>                             
        <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// en caso de que el token no se pueda decodificar</span>
            <span class="token function">err</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                message<span class="token operator">:</span> <span class="token string">'Tokén inválido'</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> decode<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>Quinto</strong> en el archivo <code>authorization.js</code> importaremos a nuestro servicio de token para determinar y dar acceso al recurso solicitado si este tiene permiso, caso contrario le mandamos una excepción (debes agregarla 😉)</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// importamos</span>
<span class="token keyword">const</span> exception <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../exception/exception.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> tokenService <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../service/token/tokenService.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// creamos el método que recibe el requerimiento, el result y el next para dar paso al recurso</span>
<span class="token keyword">const</span> <span class="token function-variable function">authorization</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
    <span class="token comment">/** este if es para hacer público nuestro endpoint http://localhost:3000/api/add    
     *  puedes usar un arreglo, si deseas liberar más enpoint
     */</span> 
    <span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">replace</span> <span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'add'</span><span class="token punctuation">)</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// continua con el recurso solicitado</span>
    <span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token comment">// verificamos si la solicitud tiene un token</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>authorization<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// muestra una excepción</span>
            exception<span class="token punctuation">.</span><span class="token function">forbidden</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">&quot;No tiene permiso&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>              
            <span class="token comment">// obtenemos el token</span>
            <span class="token keyword">const</span> token <span class="token operator">=</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>authorization<span class="token punctuation">;</span>            
            <span class="token comment">// llamamos al método que decofica el token</span>
            tokenService<span class="token punctuation">.</span><span class="token function">decodeToken</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>        
                <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// continua con el recurso solicitado</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">// muestra una excepción ya sea por token inválido o sesión expirada</span>
                exception<span class="token punctuation">.</span><span class="token function">unauthorized</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// exportamos</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> authorization<span class="token punctuation">;</span>
</code></pre></div><p><strong>Sexto</strong> debemos enviarle el token al cliente para que este lo almacene y nos lo envíe en cada solicitud, para esto debemos hacer un pequeño cambio en nuestro <code>personService.js</code> y quedaría de la siguiente manera.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// importamos nuestro token</span>
<span class="token keyword">const</span> token <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../services/token/token.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// dentro del then invocamos nuestro servicio</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">doc</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// guardamos nuestro token</span>
    <span class="token keyword">const</span> token <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;token&quot;</span><span class="token operator">:</span> tokenService<span class="token punctuation">.</span><span class="token function">createToken</span><span class="token punctuation">(</span>doc<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// exception de creación y enviamos el token</span>
    exception<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">&quot;Datos ingresados&quot;</span><span class="token punctuation">,</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>Septimo</strong>, ahora solo queda implementar nuestro middleware, y ¿dónde lo implementamos 🤔?, puedes ya sea en <code>personRoute.js</code> o en <code>app.js</code>.</p> <p>Pensemos, si colocamos en <code>personRoute.js</code>, tenemos que colocar nuestro <em>middleware</em> en cada endpoint, sin embargo, si lo colocamos en <code>app.js</code> basta con colocarlo despúes del nuestro de nuestra api, de todos modos ten las dos formas.</p> <p><code>personRoute.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// importamos express</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// hacemos uso de la función Router()</span>
<span class="token keyword">const</span> api <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// importamos nuestro controlador</span>
<span class="token keyword">const</span> personCroller <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../controller/personController.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// importamos nuestro middleware</span>
<span class="token keyword">const</span> authorization <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../middleware/authorization.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// hacemos uso de los métodos http</span>
api<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/add'</span><span class="token punctuation">,</span> authorization<span class="token punctuation">,</span> personCroller<span class="token punctuation">.</span>insert<span class="token punctuation">)</span><span class="token punctuation">;</span>
api<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/select'</span><span class="token punctuation">,</span> authorization<span class="token punctuation">,</span> personCroller<span class="token punctuation">.</span>select<span class="token punctuation">)</span><span class="token punctuation">;</span>
api<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">'/update/:id/'</span> <span class="token punctuation">,</span> authorization<span class="token punctuation">,</span>  personCroller<span class="token punctuation">.</span>update<span class="token punctuation">)</span><span class="token punctuation">;</span>
api<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">'/delete/:id'</span><span class="token punctuation">,</span> authorization<span class="token punctuation">,</span> personCroller<span class="token punctuation">.</span>borrar<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// exportamos api</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> api<span class="token punctuation">;</span>
</code></pre></div><p><code>app.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// importamos express</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// importamos body-parser</span>
<span class="token keyword">const</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'body-parser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// llamanos al función</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// importamos nuestro archivo que contiene las rutas o endpoints de persona</span>
<span class="token keyword">const</span> api <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../route/personRoute.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// importamos nuestro middleware</span>
<span class="token keyword">const</span> authorization <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../middleware/authorization.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// hacemos uso de body-parser</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span>extended<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// hacemos uso de nuestra ruta de persona</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/api'</span><span class="token punctuation">,</span> authorization<span class="token punctuation">,</span> api<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* si tuvieramos más rutas de otras collections haríamos todo como se hiso con persona
 * y aquí haríamos udo de la ruta por ejemplo
 * app.use('/api', api2);
 */</span>
<span class="token comment">// exportamos app para llamarlo en nuestro archivo app.js que está en la raíz de nuestro proyecto</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> app<span class="token punctuation">;</span>
</code></pre></div><p><a href="/nuestra-documentacion/pruebas/test-api-nodejs">Dame click para ver la ejecución implemtando app.js</a><br> <a href="http://fumacrom.com/2tqLt" target="_blank" rel="noopener noreferrer">Dame click para descargar el proyecto<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/nuestra-documentacion/java-poo/" class="prev">
        Sobre el Curso
      </a></span> <span class="next"><a href="/nuestra-documentacion/api-rest-nodejs-express-mongodb/spring-boot-mysql.html">
        Spring Boot con MySql
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/nuestra-documentacion/assets/js/app.30aeb75f.js" defer></script><script src="/nuestra-documentacion/assets/js/3.e1f8113b.js" defer></script><script src="/nuestra-documentacion/assets/js/12.c7a695f1.js" defer></script><script src="/nuestra-documentacion/assets/js/10.4c85e128.js" defer></script>
  </body>
</html>
